<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voraphon Rithidech | Go Digit Example</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    <style>
        body{
            font-family: 'Itim', cursive;
        }
        table td {
            vertical-align: middle !important;
            text-align: center !important;
        }
    </style>
</head>
<body>
    <div id="loading" class="d-flex align-items-center justify-content-center min-vh-100 min-vw-100 position-absolute " style="background-color: rgba(48, 48, 48, 0.9);z-index:9999;top:50%;left:50%;margin-right: -50%;transform: translate(-50%, -50%);">
        <div class="spinner-grow text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-secondary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-success" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-danger" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-warning" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-info" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-light" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-dark" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <div class="container w-100 p-5">
        <div class="row">
            <div class="col col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>เพิ่ม ลบ แก้ไขข้อมูล table customer</h5>
                    </div>
                    <div class="card-body">
                        <table id="tbdata" class="w-100 table table-table-responsive-xl table-bordered">
                            <thead style="font-size:20px;">
                                <tr>
                                    <td rowspan="2">ชื่อ</td> 
                                    <td rowspan="2">นามสกุล</td> 
                                    <td rowspan="2">เบอร์โทร</td>
                                    <td colspan="2"><button class="btn btn-primary w-75 " style="font-size: 20px;" onclick="openmodal(1)">เพิ่ม</button></td>
                                </tr>
                                <tr>
                                    <td>แก้ไข</td>
                                    <td>ลบ</td>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<div class="modal" tabindex="-1" role="dialog" id="mymodal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="modal-title"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="container">
                <div class="row">
                    <div class="col col-12">
                        <div class="form-group">
                            <label for="name">ชื่อ</label>
                            <input type="text" class="form-control" id="fn" placeholder="ใส่ชื่อที่นี่" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col col-12">
                        <div class="form-group">
                            <label for="lname">นามสกุล</label>
                            <input type="text" class="form-control" id="ln" placeholder="ใส่นามสกุลที่นี่" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col col-12">
                        <div class="form-group">
                            <label for="name">เบอร์โทร</label>
                            <input type="text" maxlength="10" class="form-control" id="tl" placeholder="ใส่เบอร์โทรที่นี่" required>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="submitbtn"></button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">ปิด</button>
        </div>
        </div>
    </div>
</div>
</html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script>
     $(window).on('load',function(){
        get_customer_data('all');
    });
    function openmodal(n, id = null){
        $('input').prop('readonly', false);
        var modal_title = "";
        var submitbtn = "";
        if(n == 1){
            modal_title = "เพิ่มข้อมูล";
            submitbtn = "บันทึก";
            setmodal(n);
            $('#submitbtn').attr('onClick','manage_customer_data(\'insert\')');
        }else{
            if(n == 2){
                modal_title = "แก้ไขข้อมูล";
                submitbtn = "บันทึก";
                $('#submitbtn').attr('onClick','manage_customer_data(\'update\',\''+id+'\')');
            }else if(n == 3){
                modal_title = "ลบข้อมูล";
                submitbtn = "ลบ";
                $('input').prop('readonly', true);
                $('#submitbtn').attr('onClick','manage_customer_data(\'delete\',\''+id+'\')');
            }
            get_customer_data(id, function(v){
                v = v[0];
                setmodal(false, v.first_name, v.last_name, v.tel_no);
            });
        } 
        
        $('#submitbtn').text(submitbtn);
        $('#modal-title').text(modal_title)
        $('#mymodal').modal('show');
    }
    function setmodal(n, fn = '', ln = '', tl = ''){
        if(n == true){
            $('#fn').val('');
            $('#ln').val('');
            $('#tl').val('');
        }else{
            $('#fn').val(fn);
            $('#ln').val(ln);
            $('#tl').val(tl);
        }
    }
    function loading(n){
        if(n == true){
            $('#loading').removeClass('d-none');
            $('#loading').addClass('d-flex');
        }else{
            $('#loading').removeClass('d-flex');
            $('#loading').addClass('d-none');
        }
    }
    function sleep(ms, func){
        setTimeout(function(){ func(); }, ms);
    }
   
    function get_customer_data(n = null, func = null){
        loading(true);
        $.ajax({
            type : 'get',
            url : 'api/myapis.php?action=get&cus=' + n,
            dataType : 'json',
            success : function(resp){
                if(resp.status == 200){
                    if(n != 'all'){
                        func(resp.result);
                    }else{
                        resp.result.forEach(function(v){
                            append_row(v.first_name, v.last_name, v.tel_no, v.customer_id);
                        });
                    }
                }else{
                    alert(resp.msg);
                }
            },
            complete : function(resp){
                sleep(1000, function(){loading(false)});
            }
        });
    
    }
    function append_row(fn, ln, tl, id){
        rows =  '<tr>';
        rows += '<td>' + fn + '</td>';
        rows += '<td>' + ln + '</td>';
        rows += '<td>' + tl + '</td>';
        rows += '<td><button type="button" class="btn btn-warning text-white" onclick="openmodal(2,\'' + id + '\')"><i class="fa fa-pencil-square" aria-hidden="true"></i></button></td>';
        rows += '<td><button type="button" class="btn btn-danger" onclick="openmodal(3,\'' + id + '\')"><i class="fa fa-trash" aria-hidden="true"></i></button></td>';
        rows += '</tr>'
        $('#tbdata tbody').append(rows);
    }
    function manage_customer_data(n, id = null){
        loading(true);
        var formdata = new FormData();
        
        if(n != 'delete'){
            formdata.append("fn", $('#fn').val());
            formdata.append("ln", $('#ln').val());
            formdata.append("tl", $('#tl').val());
            if(n == 'insert'){
                action = 'insert';
            }else if(n == 'update'){
                action = 'update';
                formdata.append("id", id);
            } 
        }else{
            formdata.append("id", id);
            action = 'delete';
        }
        var settings = {
            "url": "http://localhost/godigit/api/myapis.php?action="+action,
            "method": "POST",
            "timeout": 0,
            "processData": false,
            "mimeType": "multipart/form-data",
            "contentType": false,
            "data": formdata
        };
        $.ajax(settings).done(function (resp) {
            resp = JSON.parse(resp);
            if(resp.status == 200){
                $('#tbdata tbody tr').remove();
                get_customer_data('all');
                sleep(1000, function(){$('#mymodal').modal('hide');loading(false);});
            }else{
                alert(resp.msg);
                sleep(1000, function(){loading(false);});
            }
        });
    }
</script>